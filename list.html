<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EcoHabit</title>

  <!------------------------------------------>
  <!-- Bootstrap Library CSS JS CDN go here -->
  <!------------------------------------------>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>

  <!-------------------------------------------------------->
  <!-- Firebase 8 Library related CSS, JS, JQuery go here -->
  <!-------------------------------------------------------->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.css" />
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!------------------------------------------>
  <!-------- External fonts go here ---------->
  <!------------------------------------------>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet">

  <!-------------------------------------------->
  <!-- Other libraries and styles of your own -->
  <!-------------------------------------------->
  <link rel="stylesheet" href="./styles/style.css">

</head>

<body>
  <!-- our own navbar goes here -->
  <nav id="headerPlaceholder"></nav>
  <div class="body-container" id="list-container">
    <h1 id="list-title">Customize Your Habit List!</h1>
    <ul id="habit-list">
      <!-- Habit items will be added dynamically with JavaScript -->
    </ul>
    <button id="add-habit" class="btn btn-primary btn-lg btn-block">Add Habit</button>
    <button id="save-changes" class=" btn btn-primary btn-lg btn-block">Save Changes</button>

  </div>

  <nav id="navbarPlaceholder"></nav>
  <script>
    const habitList = document.querySelector('#habit-list');
    const addHabitButton = document.querySelector('#add-habit');
    const saveChangesBtn = document.getElementById("save-changes");


    // Add event listener for the Add Habit button
    addHabitButton.addEventListener('click', () => {
      const habitName = prompt("Enter a name for the new habit:");
      if (habitName) {
        addHabitItem(habitName);
      }
    });

    // Add a habit item to the list
    function addHabitItem(name) {
      const habitItem = document.createElement('li');
      habitItem.textContent = name;
      // Add event listener for the Delete Habit button, show a confirmation popup and only proceed with deletion if the user confirms.
      const deleteButton = document.createElement('button');
      deleteButton.classList.add('btn', 'btn-light', 'btn-lg');
      deleteButton.textContent = 'remove';
      deleteButton.addEventListener('click', () => {
        const confirmDelete = confirm(`Are you sure to remove ${name} from your habit list?`);
        if (confirmDelete) {

          habitList.removeChild(habitItem);
        }
      });
      habitItem.appendChild(deleteButton);

      habitList.appendChild(habitItem);
    }

    // Add some default habits to the list
    addHabitItem("Ride a bike🚴");
    addHabitItem("Eat less meat🥩");
    addHabitItem("Do recycling🚮");
    addHabitItem("Use reusable bags🛍️");
    addHabitItem("Save water💧");

    saveChangesBtn.addEventListener("click", () => {
      const confirmSaveChanges = window.confirm("Are you sure you want to save changes?");
      if (confirmSaveChanges) {
        alert("Changes saved successfully!");
      }
    });

  </script>

  <script>
    // Load the list of habits from Firestore
    function loadHabitsFromFirestore() {
      const userID = firebase.auth().currentUser.uid;
      firestore.collection('users').doc(userID).collection('habits').get().then((querySnapshot) => {
        querySnapshot.forEach((doc) => {
          const habitID = doc.id;
          const habitName = doc.data().name;
          addHabitItem(habitID, habitName);
        });
      });
    }

    // Save the list of habits to Firestore
    function saveHabitsToFirestore() {
      const userID = firebase.auth().currentUser.uid;
      const batch = firestore.batch();

      habitChanges.forEach((change) => {
        const habitRef = firestore.collection('users').doc(userID).collection('habits').doc(change.id);
        if (change.type === 'add') {
          habitsRef.add({
            name: change.name,
            id: change.id
          });
        } else if (change.type === 'remove') {
          habitsRef.where('name', '==', change.name).get().then(snapshot => {
            snapshot.docs.forEach(doc => {
              doc.ref.delete();
            });
          });
        }
      });

    }
  </script>
</body>

</html>


<script src="./scripts/firebaseAPI_BBY14.js"></script>
<script src="./scripts/skeleton.js"></script>
<script src="./scripts/main.js"></script>
<script src="./scripts/script.js"></script>

</body>

</html>